name: Deploy Docker Image

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Setup Docker Buildx
      uses: docker/setup-buildx-action@v2

    - name: Publish Docker Image to ECR
      uses: ./.github/actions/publish-api-image
      with:
        spring-profile: prod
        published-app: target/Social_Serice-0.0.1-SNAPSHOT.jar
        dockerfile: Dockerfile
        image-short-name: social-service-api
        image-prefix: devops
        image-tag: latest
        ecr-registry: ${{ secrets.ECR_REGISTRY }}
